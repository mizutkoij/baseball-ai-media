global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'baseball-ai-alerts@your-domain.com'

# ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°è¨­å®š
route:
  group_by: ['alertname', 'severity', 'component']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default-receiver'
  routes:
  # ğŸš¨ ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆ â†’ Discord + PagerDuty
  - match:
      severity: page
    receiver: 'critical-alerts'
    group_wait: 0s
    repeat_interval: 1h

  # âš ï¸ è­¦å‘Šã‚¢ãƒ©ãƒ¼ãƒˆ â†’ Discord ã®ã¿
  - match:
      severity: warn
    receiver: 'warning-alerts'
    repeat_interval: 4h

  # ğŸ”„ æ¥­å‹™æ™‚é–“å¤–ã¯ã‚µã‚¤ãƒ¬ãƒ³ãƒˆï¼ˆå¹³æ—¥ 9-21æ™‚ ä»¥å¤–ï¼‰
  - match_re:
      severity: warn
    receiver: 'silent'
    active_time_intervals:
    - business_hours_only

receivers:
# ğŸš¨ ç·Šæ€¥é€šçŸ¥å…ˆ
- name: 'critical-alerts'
  discord_configs:
  - webhook_url: '{{ .ExternalURL }}/webhook/discord/critical'
    title: 'ğŸš¨ NPB Baseball AI - CRITICAL ALERT'
    message: |
      **{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}**
      
      **Component**: {{ .CommonLabels.component }}
      **Severity**: {{ .CommonLabels.severity }}
      **Time**: {{ .CommonLabels.alertname }} 
      
      {{ range .Alerts }}
      ğŸ“‹ **Details**: {{ .Annotations.description }}
      ğŸ“š **Runbook**: {{ .Annotations.runbook_url }}
      {{ end }}
      
      ğŸ”— **Grafana**: {{ .ExternalURL }}/grafana
      ğŸ“Š **Prometheus**: {{ .ExternalURL }}/prometheus
    color: 16711680  # Red

  # PagerDutyçµ±åˆï¼ˆæœ¬æ ¼é‹ç”¨æ™‚ï¼‰
  # pagerduty_configs:
  # - routing_key: 'your-pagerduty-integration-key'
  #   description: '{{ .CommonLabels.alertname }}: {{ .CommonLabels.component }}'

# âš ï¸ è­¦å‘Šé€šçŸ¥å…ˆ
- name: 'warning-alerts'
  discord_configs:
  - webhook_url: '{{ .ExternalURL }}/webhook/discord/warning'
    title: 'âš ï¸ NPB Baseball AI - Warning'
    message: |
      **{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}**
      
      **Component**: {{ .CommonLabels.component }}
      **Time**: {{ (.Alerts | first).StartsAt.Format "2006-01-02 15:04:05 JST" }}
      
      {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
      
      ğŸ“š **Runbook**: {{ range .Alerts }}{{ .Annotations.runbook_url }}{{ end }}
    color: 16776960  # Yellow

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- name: 'default-receiver'
  discord_configs:
  - webhook_url: '{{ .ExternalURL }}/webhook/discord/general'
    title: 'ğŸ“¢ NPB Baseball AI - Alert'
    message: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'

# ã‚µã‚¤ãƒ¬ãƒ³ãƒˆ
- name: 'silent'

# æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ï¼ˆè¤‡æ•°ã‚¢ãƒ©ãƒ¼ãƒˆã®é‡è¤‡ã‚’é˜²ãï¼‰
inhibit_rules:
# ScrapeFailureSpike ãŒç™ºç”Ÿä¸­ã¯ä»–ã®ã‚¹ã‚¯ãƒ¬ãƒ¼ãƒ”ãƒ³ã‚°ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
- source_match:
    alertname: ScrapeFailureSpike
    severity: page
  target_match:
    component: scraper
  equal: ['component']

# MetricsServerDown ä¸­ã¯ä»–ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹é–¢é€£è­¦å‘Šã‚’æŠ‘åˆ¶  
- source_match:
    alertname: MetricsServerDown
  target_match:
    component: monitoring
  equal: ['job']

# æ™‚é–“å¸¯è¨­å®š
time_intervals:
- name: business_hours_only
  time_intervals:
  - times:
    - start_time: '09:00'
      end_time: '21:00'
    weekdays: ['monday:friday']
    location: 'Asia/Tokyo'